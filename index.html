<head>
	<meta charset="utf-8" />
	<meta name="description" content="Asana Adoption Agency is a proud partner of [shelter name] located in San Francisco, California, with over 2000 pets looking for a new place to call home. Additional description of puppies, kitties, and other SEO friendly words.">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Adopt a puppy at Asana Pet Adoption Agency today.</title>
	<link href="https://fonts.googleapis.com/css?family=Poppins:300,300i,400" rel="stylesheet"> 
	<link rel="icon" href="https://d1gwm4cf8hecp4.cloudfront.net/images/favicons/favicon-16x16.png">
	<link rel="stylesheet" href="./assets/app.css" type="text/css" />
</head>

<body>
	
	<!-- Full Screen Image Panel -->
	<div id="panel" class="closed ease">
		<img id="dog-lightbox" class="center"/>		
		<div class="button" onclick="togglePanel()">
			<div class="chevron ease-fast"></div>
		</div>
	</div>
	
	<!-- Main Content -->
	<div id="main-content" class="ease" style="opacity: 0;">
		
		<div include="./assets/snippets/header.html"></div>
		
		<div class="banner">
			<h3>Asana is a proud partner of [SHELTER NAME] with over 2000 pets looking for a new place to call home.</h3>
		</div>
		
		<div id="dogs-gallery" class="justified-gallery justified-gallery-margin"></div>
		<a href="javascript:void(0);" onclick="fetchDogs()" role="button">See More</a>
		
		<div include="./assets/snippets/footer.html"></div>
		
	</div>
	
	<!-- Can be moved to main.js; left in index.html for readability in evaluation -->
	<script>
		var dogsCount = 0
		
		function includeHTML() {
			var z, i, elmnt, file, xhttp;
			/*loop through a collection of all HTML elements:*/
			z = document.getElementsByTagName("*");
			for (i = 0; i < z.length; i++) {
				elmnt = z[i];
				/*search for elements with a certain atrribute:*/
				file = elmnt.getAttribute("include");
				if (file) {
					/*make an HTTP request using the attribute value as the file name:*/
					xhttp = new XMLHttpRequest();
					xhttp.onreadystatechange = function() {
						if (this.readyState == 4) {
							if (this.status == 200) {elmnt.innerHTML = this.responseText;}
							if (this.status == 404) {elmnt.innerHTML = "Page not found.";}
							/*remove the attribute, and call this function once more:*/
							elmnt.removeAttribute("include");
							includeHTML();
						}
					} 
					xhttp.open("GET", file, true);
					xhttp.send();
					/*exit the function:*/
					return;
				}
			}
		}
		
		function onHeaderLoad() {
			document.getElementById('main-content').removeAttribute('style');
			fetchDogs();
		}
		
		function onScroll() {
			if (document.body.scrollTop > 0) {
				document.getElementById("menu-bar").classList.add("scrolled");
			} else {
				document.getElementById("menu-bar").classList.remove("scrolled");
			}
		}
		
		function togglePanel(element) {
			if (element) {
				var lightbox = document.getElementById('dog-lightbox');
				var image = element.firstElementChild;
				lightbox.src = image.src;
				lightbox.alt = image.alt;
			}
			document.getElementById('panel').classList.toggle('closed');
		}
		
		function showImages(imageCount) {
			for (var i = 1; i <= imageCount; i++) {
				showImage(dogsCount, imageCount, i);
			}
		}
		
		function showImage(dogCount, imageCount, index) {
			setTimeout(function() {
				document.getElementById("dog-" + (dogCount - imageCount + index)).style.opacity = 1;
			}, 150 * index);
		}
		
		function fetchDogs() {
			var xmlhttp = new XMLHttpRequest();
			xmlhttp.onreadystatechange = function() {
				var gallery = document.getElementById("dogs-gallery");
				if (this.readyState == 4 && this.status == 200) {
					var dogs = JSON.parse(this.responseText).dogs;
					
					var loadedCount = 0;
					
					for (var i = 0; i < dogs.length; i++) {
						dogsCount++;

						var img = document.createElement("img");
						img.onload = function() {
							loadedCount++
							if (loadedCount == dogs.length) {
								showImages(dogs.length);
							}
						};

						img.src = "." + dogs[i].image;
						img.alt = "Dog " + dogsCount;
						img.id = "dog-" + dogsCount;
						img.className = "ease";
						
						var div = document.createElement('div');
						div.appendChild(img);
						div.classList.add('ease-fast', 'dog');
						div.onclick = function(){togglePanel(this)};

						gallery.appendChild(div);
					};
				}
				if (this.status == 400) {
					gallery.innerHTML = "Dogs could not be loaded."
				}
			};
			
			xmlhttp.open("GET", "./assets/data/dogs.json", true);
			xmlhttp.overrideMimeType("text/plain");
			xmlhttp.send();
			/*exit the function:*/
			return;
		}
		
		includeHTML();
		
		window.onscroll = function(){
			onScroll()
		};
	</script>
</body>
